<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slack Bot</title>
    <style>
        body {
            font-family: Arial, 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            color: #333;
            background: white;
        }
        h1 { 
            color: #2563eb;
            font-size: 2em;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 10px;
            margin: 30px 0 20px 0;
        }
        h2 { 
            color: #1e40af;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 5px;
        }
        h3 { 
            color: #1e3a8a;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }
        h4 {
            color: #374151;
            font-size: 1.1em;
            margin: 15px 0 10px 0;
        }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #dc2626;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            line-height: 1.4;
            margin: 15px 0;
        }
        pre code {
            background: none;
            color: #f9fafb;
            padding: 0;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 20px 0;
            padding-left: 20px;
            color: #4b5563;
            font-style: italic;
            background: #f9fafb;
            padding: 15px 20px;
        }
        a {
            color: #2563eb;
            text-decoration: none;
            border-bottom: 1px dotted #2563eb;
        }
        a:hover {
            border-bottom: 1px solid #2563eb;
        }
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        li {
            margin-bottom: 8px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #d1d5db;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f3f4f6;
            font-weight: bold;
            color: #1f2937;
        }
        tr:nth-child(even) {
            background: #f9fafb;
        }
        hr {
            border: none;
            border-top: 2px solid #e5e7eb;
            margin: 30px 0;
        }
        .info-box {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .warning-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .code-filename {
            background: #374151;
            color: #9ca3af;
            padding: 5px 10px;
            border-radius: 5px 5px 0 0;
            font-size: 0.85em;
            margin-bottom: -5px;
            display: inline-block;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            color: #6b7280;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
<h1>Building a Slack Bot with Encore.ts</h1>

<h2>Overview</h2>

<p>This tutorial guides you through creating a Slack bot using Encore.ts that implements a &quot;/cowsay&quot; command. You&#x27;ll learn how to:</p>

<ul>
<li>Create a serverless backend with webhook integration</li>
<li>Handle Slack slash commands</li>
<li>Implement security verification for Slack requests</li>
<li>Deploy and configure a production Slack bot</li>
</ul>

<h2>Prerequisites</h2>

<ul>
<li>Encore CLI</li>
<li>Slack workspace with admin permissions</li>
<li>Node.js</li>
</ul>

<h2>Step 1: Create Encore Application</h2>

<p><strong><em>CODE</em>BLOCK<em>0</strong></em></p>

<p>Note your app ID from the output - you&#x27;ll need it for Slack configuration.</p>

<h2>Step 2: Create Slack App</h2>

<ul>
<li>Go to <a href="https://api.slack.com/apps">Slack API website</a></li>
<li>Click &quot;Create New App&quot; â†’ &quot;From an app manifest&quot;</li>
<li>Use this manifest (replace YOUR<em>APP</em>ID):</li>
</ul>

<p><strong><em>CODE</em>BLOCK<em>1</strong></em></p>

<h2>Step 3: Implement Slack Service</h2>

<p>Create <code>slack/encore.service.ts</code>:
<strong><em>CODE</em>BLOCK<em>2</strong></em></p>

<p>Create <code>slack/slack.ts</code>:
<strong><em>CODE</em>BLOCK<em>3</strong></em>&quot; + cowsayText + &quot;``<code>&quot;
    }));
  }
);</p>

<p>function verifySlackSignature(body: Buffer, timestamp: string, signature: string): boolean {
  const signingSecret = slackSigningSecret();
  
  // Reject old requests (older than 5 minutes)
  const now = Math.floor(Date.now() / 1000);
  if (Math.abs(now - parseInt(timestamp)) &gt; 300) {
    return false;
  }
  
  // Compute the expected signature
  const sigBasestring = </code>v0:${timestamp}:${body.toString()}<code>;
  const expectedSignature = </code>v0=${createHmac(&#x27;sha256&#x27;, signingSecret)
    .update(sigBasestring)
    .digest(&#x27;hex&#x27;)}<code>;
  
  // Compare signatures securely
  return signature &amp;&amp; timingSafeEqual(
    Buffer.from(expectedSignature),
    Buffer.from(signature)
  );
}</p>

<p>function generateCowsay(text: string): string {
  const message = text.length &gt; 40 ? text.substring(0, 37) + &quot;...&quot; : text;
  const border = &quot;-&quot;.repeat(message.length + 2);
  
  return </code>
 ${border}
&lt; ${message} &gt;
 ${border}
        \\   ^__^
         \\  (oo)\\<strong><em></strong></em>_
            (__)\\       )\\/\\
                ||----w |
                ||     ||<code>;
}
<strong><em>CODE</em>BLOCK<em>4</strong></em>bash
encore secret set --type dev,staging,prod SlackSigningSecret
<strong><em>CODE</em>BLOCK<em>5</strong></em>typescript
interface CowsayOptions {
  eyes?: string;
  tongue?: string;
  mode?: &#x27;default&#x27; | &#x27;borg&#x27; | &#x27;dead&#x27; | &#x27;greedy&#x27; | &#x27;paranoid&#x27; | &#x27;stoned&#x27; | &#x27;tired&#x27; | &#x27;wired&#x27; | &#x27;young&#x27;;
}</p>

<p>export function generateAdvancedCowsay(text: string, options: CowsayOptions = {}): string {
  const { eyes = &quot;oo&quot;, tongue = &quot;  &quot;, mode = &quot;default&quot; } = options;
  
  // Apply mode-specific settings
  const modeSettings = getModeSettings(mode);
  const actualEyes = modeSettings.eyes || eyes;
  const actualTongue = modeSettings.tongue || tongue;
  
  // Word wrap the text
  const lines = wrapText(text, 38);
  const maxLength = Math.max(...lines.map(line =&gt; line.length));
  
  // Create speech bubble
  const border = &quot;-&quot;.repeat(maxLength + 2);
  const bubble = [
    </code> ${border}<code>,
    ...lines.map((line, index) =&gt; {
      const padding = &quot; &quot;.repeat(maxLength - line.length);
      if (lines.length === 1) return </code>&lt; ${line}${padding} &gt;<code>;
      if (index === 0) return </code>/ ${line}${padding} \\<code>;
      if (index === lines.length - 1) return </code>\\ ${line}${padding} /<code>;
      return </code>| ${line}${padding} |<code>;
    }),
    </code> ${border}<code>
  ].join(&#x27;\n&#x27;);
  
  // Create cow
  const cow = </code>
        \\   ^__^
         \\  (${actualEyes})\\<strong><em></strong></em>_
            (__)\\       )\\/\\
             ${actualTongue} ||----w |
                ||     ||<code>;
  
  return bubble + cow;
}</p>

<p>function getModeSettings(mode: string) {
  const modes: Record&lt;string, { eyes?: string; tongue?: string }&gt; = {
    borg: { eyes: &quot;==&quot; },
    dead: { eyes: &quot;xx&quot;, tongue: &quot;U &quot; },
    greedy: { eyes: &quot;$$&quot; },
    paranoid: { eyes: &quot;@@&quot; },
    stoned: { eyes: &quot;**&quot;, tongue: &quot;U &quot; },
    tired: { eyes: &quot;--&quot; },
    wired: { eyes: &quot;OO&quot; },
    young: { eyes: &quot;..&quot; }
  };
  return modes[mode] || {};
}</p>

<p>function wrapText(text: string, maxWidth: number): string[] {
  const words = text.split(&#x27; &#x27;);
  const lines: string[] = [];
  let currentLine = &#x27;&#x27;;
  
  for (const word of words) {
    if ((currentLine + word).length &lt;= maxWidth) {
      currentLine += (currentLine ? &#x27; &#x27; : &#x27;&#x27;) + word;
    } else {
      if (currentLine) lines.push(currentLine);
      currentLine = word;
    }
  }
  
  if (currentLine) lines.push(currentLine);
  return lines.length ? lines : [&#x27;&#x27;];
}
<strong><em>CODE</em>BLOCK<em>6</strong></em>typescript
export const cowsay = api.raw(
  { expose: true, path: &quot;/slack/cowsay&quot;, method: &quot;POST&quot; },
  async (req, resp) =&gt; {
    // ... verification code ...
    
    const body = new URLSearchParams(req.body.toString());
    const text = body.get(&quot;text&quot;) || &quot;Hello, World!&quot;;
    
    // Parse command options
    const parts = text.split(&#x27; &#x27;);
    const options: CowsayOptions = {};
    let message = text;
    
    // Check for mode flags
    if (parts[0] &amp;&amp; parts[0].startsWith(&#x27;-&#x27;)) {
      const mode = parts[0].substring(1);
      options.mode = mode as any;
      message = parts.slice(1).join(&#x27; &#x27;);
    }
    
    const cowsayText = generateAdvancedCowsay(message, options);
    
    resp.writeHead(200, { &quot;Content-Type&quot;: &quot;application/json&quot; });
    resp.end(JSON.stringify({
      response<em>type: &quot;in</em>channel&quot;,
      text: &quot;</code>`<code>&quot; + cowsayText + &quot;</code>`<code>&quot;
    }));
  }
);
<strong><em>CODE</em>BLOCK<em>7</strong></em>bash
<h1>Deploy to staging</h1>
git add . &amp;&amp; git commit -m &quot;Slack bot implementation&quot;
git push encore</p>

<h1>Install the Slack app to your workspace</h1>
<h1>Test with: /cowsay Hello from Encore!</h1>
<h1>Test modes: /cowsay -dead Something spooky</h1>
<strong><em>CODE</em>BLOCK<em>8</strong></em>
/cowsay Hello, World!
<strong><em>CODE</em>BLOCK<em>9</strong></em>
/cowsay -dead I&#x27;m not feeling well
/cowsay -borg Resistance is futile
/cowsay -stoned Whoa, dude...
</code>``</p>

<h2>Key Features</h2>

<ul>
<li><strong>Secure webhook verification</strong> using HMAC signatures</li>
<li><strong>Multiple cow modes</strong> for different personalities</li>
<li><strong>Word wrapping</strong> for long messages</li>
<li><strong>Production-ready deployment</strong> with Encore Cloud</li>
<li><strong>Secret management</strong> for API credentials</li>
</ul>

<h2>Security Considerations</h2>

<ul>
<li>Always verify Slack signatures to prevent unauthorized requests</li>
<li>Use timing-safe comparison for signature verification</li>
<li>Reject old requests to prevent replay attacks</li>
<li>Store sensitive credentials in Encore&#x27;s secret management</li>
<li>Use HTTPS endpoints for all Slack integrations</li>
</ul>

<p>This tutorial demonstrates how to build a robust, secure Slack bot using Encore.ts with minimal infrastructure setup and built-in security best practices.</p>
<div class="footer">
    <p>
        <strong>Encore TypeScript Documentation</strong><br>
        Original: tutorials/slack-bot.md<br>
        Converted: 2025-08-22 06:46:14<br>
        <em>Open in Chrome and copy-paste to Google Docs for best results</em>
    </p>
</div>
</body>
</html>